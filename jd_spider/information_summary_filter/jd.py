import jsonimport reimport requestsfrom lxml import etreefrom information_summary_filter.config import connect,cursorimport csvdef get_goods_id(search_url):    print(search_url)    headers = {        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36',        'Host': 'search.jd.com',        'Upgrade-Insecure-Requests': '1',    }    res = requests.get(search_url,headers=headers)    res.encoding=('utf8')    info= res.text    selector = etree.HTML(info)    goods_ids = selector.xpath('//li[@class="gl-item"]/@data-sku')    prices = re.findall('<em>￥</em><i>(.*?)</i>',str(info))    return goods_ids,pricesdef get_detailInfo(goods_id,price,keyword):    detail_url = 'https://item.jd.com/{}.html'.format(goods_id)    headers = {        'user-agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36',    }    types = keyword    d_res = requests.get(detail_url,headers=headers)    detail_info = d_res.text    selector = etree.HTML(detail_info)    title = re.findall("<img alt='(.*?)'",str(detail_info))[0]    pic_url ='https:' +  selector.xpath('//img[@id="spec-img"]/@data-origin')[0]    comm_num_url = 'https://club.jd.com/comment/productPageComments.action?productId={}&score=1&sortType=5&page=1&pageSize=10&isShadowSku=0&rid=0&fold=1'.format(goods_id)    headers = {        'Host': 'club.jd.com',        'Referer': detail_url,        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36',    }    c_res = requests.get(comm_num_url, headers=headers)    info_json = json.loads(c_res.text)    goodRate = info_json['productCommentSummary']['goodRate']  # 好评度                                          # 手动设置数据库爬取日期    try:        sql = 'insert into jddate(goods_id,title,price,detail_url,goodRate,pic_url,types) VALUES (%s,%s,%s,%s,%s,%s,%s)'        cursor.execute(sql, (        str(goods_id), str(title), str(price), str(detail_url), str(goodRate), str(pic_url), str(types)))        connect.commit()        print('--------------mysql数据插入成功--------------------')    except Exception as e:        print(e)